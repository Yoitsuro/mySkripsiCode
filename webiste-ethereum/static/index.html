<body>
  <div class="card">
    <h1>Forecast Harga Ethereum</h1>
    <p>
      Model: TCN-LGBM (Stacking) â€” menampilkan forecast 1, 5, dan 30 jam ke
      depan.
    </p>
  </div>

  <div class="card">
    <h2>Forecast ke Depan</h2>
    <p>
      Prediksi harga <strong>close</strong> ETH/USDT berdasarkan data historis
      terakhir.
    </p>
    <div class="metrics">
      <div class="metric-box">
        <div class="metric-label">+1 Jam</div>
        <div class="metric-value" id="pred-1h">-</div>
        <div class="metric-label" id="steps-1h"></div>
      </div>
      <div class="metric-box">
        <div class="metric-label">+5 Jam</div>
        <div class="metric-value" id="pred-5h">-</div>
        <div class="metric-label" id="steps-5h"></div>
      </div>
      <div class="metric-box">
        <div class="metric-label">+30 Jam</div>
        <div class="metric-value" id="pred-30h">-</div>
        <div class="metric-label" id="steps-30h"></div>
      </div>
    </div>
  </div>

  <div class="card">
    <h2>Akurasinya (Split A - Test)</h2>
    <div class="metrics">
      <div class="metric-box">
        <div class="metric-label">MAE</div>
        <div class="metric-value" id="mae">-</div>
      </div>
      <div class="metric-box">
        <div class="metric-label">RMSE</div>
        <div class="metric-value" id="rmse">-</div>
      </div>
      <div class="metric-box">
        <div class="metric-label">MAPE (%)</div>
        <div class="metric-value" id="mape">-</div>
      </div>
    </div>
  </div>

  <!-- script Chart.js boleh kamu hapus kalau belum perlu grafik -->

  <script>
    // helper error
    function showError(msg) {
      let box = document.getElementById("error-box");
      if (!box) {
        box = document.createElement("div");
        box.id = "error-box";
        box.style.marginTop = "8px";
        box.style.color = "#fca5a5";
        box.style.fontSize = "0.85rem";
        document.body.prepend(box);
      }
      box.textContent = "Error: " + msg;
      console.error(msg);
    }

    async function fetchForecastHours() {
      try {
        const res = await fetch("/forecast_hours");
        if (!res.ok) {
          showError("Gagal fetch /forecast_hours (" + res.status + ")");
          return null;
        }
        return await res.json();
      } catch (e) {
        showError("Gagal fetch /forecast_hours: " + e);
        return null;
      }
    }

    async function fetchMetrics() {
      try {
        const res = await fetch("/metrics");
        if (!res.ok) {
          showError("Gagal fetch /metrics (" + res.status + ")");
          return null;
        }
        return await res.json();
      } catch (e) {
        showError("Gagal fetch /metrics: " + e);
        return null;
      }
    }

    function renderForecastCards(data) {
      if (!data) return;
      const fmt = (v) =>
        v.toLocaleString(undefined, {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2,
        });

      const h1 = data["1h"];
      const h5 = data["5h"];
      const h30 = data["30h"];

      document.getElementById("pred-1h").innerText = fmt(h1.pred_stack);
      document.getElementById("pred-5h").innerText = fmt(h5.pred_stack);
      document.getElementById("pred-30h").innerText = fmt(h30.pred_stack);

      document.getElementById(
        "steps-1h"
      ).innerText = `(steps: ${h1.steps_used})`;
      document.getElementById(
        "steps-5h"
      ).innerText = `(steps: ${h5.steps_used})`;
      document.getElementById(
        "steps-30h"
      ).innerText = `(steps: ${h30.steps_used})`;
    }

    function renderMetrics(m) {
      if (!m) return;
      document.getElementById("mae").innerText = m.MAE.toFixed(4);
      document.getElementById("rmse").innerText = m.RMSE.toFixed(4);
      document.getElementById("mape").innerText = m.MAPE.toFixed(2);
    }

    async function init() {
      const [fh, metrics] = await Promise.all([
        fetchForecastHours(),
        fetchMetrics(),
      ]);
      renderForecastCards(fh);
      renderMetrics(metrics);
    }

    init();
  </script>
</body>
